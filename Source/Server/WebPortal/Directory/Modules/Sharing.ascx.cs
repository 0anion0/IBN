namespace Mediachase.UI.Web.Directory.Modules
{
	using System;
	using System.Data;
	using System.Drawing;
	using System.Web;
	using System.Web.UI.WebControls;
	using System.Web.UI.HtmlControls;
	using System.Resources;
	using Mediachase.IBN.Business;
	using Mediachase.UI.Web.Util;

	/// <summary>
	///		Summary description for Sharing.
	/// </summary>
	public partial class Sharing : System.Web.UI.UserControl
	{
		public ResourceManager LocRM;

		#region UserID
		private int UserID
		{
			get
			{
				try
				{
					if (Request["UserID"] != null)
						return int.Parse(Request["UserID"]);
					else
					{
						if (Request["AccountID"] != null)
						{
							int iID = 0;
							using (IDataReader reader = User.GetUserInfoByOriginalId(int.Parse(Request["AccountID"])))
							{
								if (reader.Read())
									iID = (int)reader["UserId"];
							}
							if (iID > 0)
								return iID;
							else
								return Security.CurrentUser.UserID;
						}
						else
							return Security.CurrentUser.UserID;
					}
				}
				catch
				{
					throw new Exception("Invalid User ID");
				}
			}
		}
		#endregion

		protected void Page_Load(object sender, System.EventArgs e)
		{
			if (UserID != Security.CurrentUser.UserID)
				this.Visible = false;
			else
			{
				LocRM = new ResourceManager("Mediachase.UI.Web.App_GlobalResources.Directory.Resources.strSharing", typeof(Sharing).Assembly);
				BindToolbar();
				BinddgMembers();
			}
		}

		#region BindToolbar
		private void BindToolbar()
		{
			secHeader.AddText(LocRM.GetString("Sharing"));
			secHeader.AddRightLink("<img alt='' src='../Layouts/Images/edit.gif'/> " + LocRM.GetString("Modify"), "javascript:ModifySharing(" + UserID + ")");
		}
		#endregion

		#region BinddgMembers
		private void BinddgMembers()
		{
			dgSharing.DataSource = User.GetListPeopleForSharing(UserID);
			dgSharing.DataBind();
		}
		#endregion

		#region GetLevel
		protected string GetLevel(int level)
		{
			if (level == 1)
				return LocRM.GetString("Manage");
			else
				return LocRM.GetString("Read");
		}
		#endregion

		#region Web Form Designer generated code
		override protected void OnInit(EventArgs e)
		{
			//
			// CODEGEN: This call is required by the ASP.NET Web Form Designer.
			//
			InitializeComponent();
			base.OnInit(e);
		}

		///		Required method for Designer support - do not modify
		///		the contents of this method with the code editor.
		/// </summary>
		private void InitializeComponent()
		{

		}
		#endregion

		#region btnRefresh_Click
		protected void btnRefresh_Click(object sender, System.EventArgs e)
		{
			BinddgMembers();
		}
		#endregion

		//===========================================================================
		// This public property was added by conversion wizard to allow the access of a protected, autogenerated member variable secHeader.
		//===========================================================================
		public Mediachase.UI.Web.Modules.BlockHeaderLightWithMenu secHeader
		{
			get { return Migrated_secHeader; }
			//set { Migrated_secHeader = value; }
		}
	}
}
